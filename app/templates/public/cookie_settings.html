{% extends "base.html" %}

{% block title %}Ã‡erez Tercihleri YÃ¶netimi{% endblock %}

{% block content %}
<div class="container mx-auto my-12 px-4">
  <div class="max-w-4xl mx-auto bg-white p-6 md:p-10 rounded-2xl shadow-lg border border-gray-200">

    <!-- BaÅŸlÄ±k -->
    <div class="text-center mb-8">
      <h1 class="text-3xl md:text-4xl font-extrabold text-gray-900 tracking-tight">Ã‡erez Tercihleri YÃ¶netimi</h1>
      <p class="text-gray-600 mt-2">
        Web sitemizde deneyiminizi geliÅŸtirmek iÃ§in kullandÄ±ÄŸÄ±mÄ±z teknolojiler hakkÄ±nda bilgi alabilir ve tercihlerinizi yÃ¶netebilirsiniz.
      </p>
    </div>

    <!-- AÃ§Ä±klama -->
    <div class="prose max-w-none text-gray-700 mb-8">
      <h2 class="text-2xl font-bold text-gray-900">Ã‡erez Nedir ve Neden KullanÄ±yoruz?</h2>
      <p>
        Ã‡erezler, ziyaret ettiÄŸiniz web siteleri tarafÄ±ndan tarayÄ±cÄ±nÄ±za kaydedilen kÃ¼Ã§Ã¼k metin dosyalarÄ±dÄ±r.
        Sitemizi ziyaret ettiÄŸinizde kullanÄ±cÄ± deneyiminizi iyileÅŸtirmek, gÃ¼venliÄŸi saÄŸlamak ve sitemizin
        performansÄ±nÄ± analiz etmek gibi amaÃ§larla Ã§erezler kullanmaktayÄ±z.
      </p>
      <p>
        KullandÄ±ÄŸÄ±mÄ±z Ã§erezler hakkÄ±nda detaylÄ± bilgiyi
        <!-- GÃœNCELLENEN SATIR BURASI -->
        <a href="{{ url_for('public.privacy_policy') }}" class="text-indigo-600 underline">Gizlilik PolitikasÄ±</a>
        sayfamÄ±zda bulabilirsiniz. Burada yaptÄ±ÄŸÄ±nÄ±z tercihler yalnÄ±zca bu tarayÄ±cÄ± ve cihaz iÃ§in geÃ§erlidir.
      </p>
    </div>

    <!-- Kartlar (DeÄŸiÅŸiklik yok) -->
    <div class="space-y-6">

      <!-- Zorunlu -->
      <section class="bg-gray-50 p-6 rounded-xl border border-gray-200">
        <div class="flex items-start justify-between gap-6">
          <div>
            <div class="flex items-center gap-2">
              <span class="inline-flex items-center justify-center w-6 h-6 rounded-lg bg-gray-200">ğŸ”’</span>
              <h3 class="text-lg font-bold text-gray-900">Zorunlu Oturum Ã‡erezleri</h3>
            </div>
            <p class="mt-2 text-sm text-gray-600">
              Bu Ã§erezler, web sitesinin temel fonksiyonlarÄ±nÄ±n (kullanÄ±cÄ± giriÅŸi, gÃ¼venlik vb.) Ã§alÄ±ÅŸmasÄ± iÃ§in gereklidir.
              Sitemiz bu Ã§erezler olmadan dÃ¼zgÃ¼n Ã§alÄ±ÅŸamaz ve bu nedenle devre dÄ±ÅŸÄ± bÄ±rakÄ±lamazlar.
            </p>
          </div>
          <div class="text-right">
            <span class="text-xs font-medium text-green-700 bg-green-100 px-2 py-1 rounded-full">Her Zaman Aktif</span>
          </div>
        </div>
      </section>

      <!-- Analitik -->
      <section class="bg-gray-50 p-6 rounded-xl border border-gray-200">
        <div class="flex items-start justify-between gap-6">
          <div>
            <div class="flex items-center gap-2">
              <span class="inline-flex items-center justify-center w-6 h-6 rounded-lg bg-indigo-100">ğŸ“Š</span>
              <h3 class="text-lg font-bold text-gray-900">Performans ve Analitik Ã‡erezleri</h3>
            </div>
            <p class="mt-2 text-sm text-gray-600">
              Bu Ã§erezler, sitemizi kaÃ§ kiÅŸinin ziyaret ettiÄŸini ve hangi sayfalarda ne kadar zaman geÃ§irildiÄŸini anonim olarak Ã¶lÃ§memize yardÄ±mcÄ± olur.
              Hizmeti iyileÅŸtirmemize destek olur. Kabul edip etmemek tamamen sizin tercihinizdir.
            </p>
          </div>

          <!-- Toggle -->
          <label class="inline-flex items-center select-none cursor-pointer" aria-label="Analitik Ã§erezleri etkinleÅŸtir">
            <input id="analitik-cerezler" type="checkbox" class="sr-only peer">
            <span class="w-11 h-6 bg-gray-300 rounded-full relative transition-colors peer-checked:bg-indigo-600">
              <span class="absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full shadow transition-transform peer-checked:translate-x-5"></span>
            </span>
          </label>
        </div>
      </section>

      <!-- Pazarlama -->
      <section class="bg-gray-50 p-6 rounded-xl border border-gray-200">
        <div class="flex items-start justify-between gap-6">
          <div>
            <div class="flex items-center gap-2">
              <span class="inline-flex items-center justify-center w-6 h-6 rounded-lg bg-pink-100">ğŸ¯</span>
              <h3 class="text-lg font-bold text-gray-900">Pazarlama ve Reklam Ã‡erezleri</h3>
            </div>
            <p class="mt-2 text-sm text-gray-600">
              Ä°lgi alanlarÄ±nÄ±za yÃ¶nelik daha alakalÄ± reklamlar gÃ¶stermek iÃ§in kullanÄ±lÄ±r. <strong>Åu anda bu tÃ¼r Ã§erezleri aktif olarak kullanmÄ±yoruz</strong>,
              ancak gelecekte kullanma ihtimalimize karÅŸÄ± burada tercih hakkÄ± sunuyoruz.
            </p>
          </div>

          <!-- Toggle -->
          <label class="inline-flex items-center select-none cursor-pointer" aria-label="Pazarlama Ã§erezlerini etkinleÅŸtir">
            <input id="pazarlama-cerezler" type="checkbox" class="sr-only peer">
            <span class="w-11 h-6 bg-gray-300 rounded-full relative transition-colors peer-checked:bg-indigo-600">
              <span class="absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full shadow transition-transform peer-checked:translate-x-5"></span>
            </span>
          </label>
        </div>
      </section>
    </div>

    <!-- Aksiyonlar (DeÄŸiÅŸiklik yok) -->
    <div class="mt-10 pt-6 border-t border-gray-200 flex flex-col sm:flex-row items-center justify-between gap-3">
      <div id="save-success-message" class="hidden text-sm font-medium text-green-700 bg-green-50 px-3 py-2 rounded-lg">
        Tercihleriniz kaydedildi.
      </div>
      <div class="flex flex-col sm:flex-row gap-3">
        <button id="accept-all-btn" class="w-full sm:w-auto bg-gray-200 text-gray-900 font-semibold py-2 px-6 rounded-lg hover:bg-gray-300 transition">
          TÃ¼mÃ¼nÃ¼ Kabul Et
        </button>
        <button id="reject-all-btn" class="w-full sm:w-auto bg-gray-100 text-gray-700 font-semibold py-2 px-6 rounded-lg hover:bg-gray-200 transition">
          TÃ¼mÃ¼nÃ¼ Reddet
        </button>
        <button id="save-prefs-btn" class="w-full sm:w-auto bg-indigo-600 text-white font-semibold py-2 px-6 rounded-lg hover:bg-indigo-700 transition">
          Tercihlerimi Kaydet
        </button>
      </div>
    </div>

  </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<!-- Script bÃ¶lÃ¼mÃ¼nde deÄŸiÅŸiklik yok -->
<script>
document.addEventListener('DOMContentLoaded', function () {
  // Toggle referanslarÄ±
  const toggles = {
    analytics: document.getElementById('analitik-cerezler'),
    marketing: document.getElementById('pazarlama-cerezler')
  };

  const saveBtn   = document.getElementById('save-prefs-btn');
  const acceptAll = document.getElementById('accept-all-btn');
  const rejectAll = document.getElementById('reject-all-btn');
  const successEl = document.getElementById('save-success-message');

  // localStorage anahtarlarÄ±
  const KEY_MAIN  = 'cookieConsent';                 // 'accepted' | 'declined' | (yok)
  const KEY_PREFS = 'cookieConsentPreferences';      // JSON: { analytics: bool, marketing: bool }

  // KaydedilmiÅŸ tercihleri yÃ¼kle
  function loadPreferences() {
    try {
      const prefs = JSON.parse(localStorage.getItem(KEY_PREFS)) || {};
      if (toggles.analytics) toggles.analytics.checked = !!prefs.analytics;
      if (toggles.marketing) toggles.marketing.checked = !!prefs.marketing;
    } catch (e) { /* yoksay */ }
  }

  // Tercihleri kaydet
  function savePreferences() {
    const newPrefs = {
      analytics: toggles.analytics ? !!toggles.analytics.checked : false,
      marketing: toggles.marketing ? !!toggles.marketing.checked : false
    };
    // Ana rÄ±zayÄ± kullanÄ±cÄ±nÄ±n seÃ§im yaptÄ±ÄŸÄ± anlamÄ±nda accepted olarak iÅŸaretliyoruz
    localStorage.setItem(KEY_MAIN, 'accepted');
    localStorage.setItem(KEY_PREFS, JSON.stringify(newPrefs));

    // Bildirim
    successEl.classList.remove('hidden');
    setTimeout(() => successEl.classList.add('hidden'), 3000);
  }

  // Hepsini kabul
  function acceptAllPreferences() {
    if (toggles.analytics) toggles.analytics.checked = true;
    if (toggles.marketing) toggles.marketing.checked = true;
    savePreferences();
  }

  // Hepsini reddet
  function rejectAllPreferences() {
    if (toggles.analytics) toggles.analytics.checked = false;
    if (toggles.marketing) toggles.marketing.checked = false;
    // Ana rÄ±zayÄ± declined olarak gÃ¼ncelle
    localStorage.setItem(KEY_MAIN, 'declined');
    localStorage.setItem(KEY_PREFS, JSON.stringify({ analytics: false, marketing: false }));
    successEl.textContent = 'TÃ¼m Ã§erez kategorileri reddedildi.';
    successEl.classList.remove('hidden');
    setTimeout(() => {
      successEl.textContent = 'Tercihleriniz kaydedildi.';
      successEl.classList.add('hidden');
    }, 3000);
  }

  // Eventler
  if (saveBtn)   saveBtn.addEventListener('click', savePreferences);
  if (acceptAll) acceptAll.addEventListener('click', acceptAllPreferences);
  if (rejectAll) rejectAll.addEventListener('click', rejectAllPreferences);

  // Klavye eriÅŸilebilirliÄŸi: Enter/Space ile Kaydet
  document.addEventListener('keydown', function(e){
    if ((e.key === 'Enter' || e.key === ' ') && (document.activeElement === saveBtn)) {
      e.preventDefault();
      savePreferences();
    }
  });

  // Ä°lk yÃ¼kleme
  loadPreferences();
});
</script>
{% endblock %}
